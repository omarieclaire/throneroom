var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.createTemplateTagFirstArg=function(a){return a.raw=a};$jscomp.createTemplateTagFirstArgWithRaw=function(a,b){a.raw=b;return a};
var database,screenOrientation,canvasWidth,canvasHeight,standardTimer=3E3,currentColor="black",currentAngle="1",scene="preline",bathroomLineUpTime=10,toiletPaperTile,DBLUE="#64afd9",LBLUE="#defaff",MBLUE="#a9e8f5",LPINK="#fb9c96",DPINK="#f1635a",PURPLE="#b25dff",LYELLOW="#ffd183",DYELLOW="#ffa304",LPEACH="#ffcfb3",DPEACH="#ffb48a",PBLUE="#02b0ef",PPINK="#fc11a2",PPEACH="#fe574c",PPURPLE="#7f00cb",PYELLOW="#ec8902",PORANGE="#ff5806",PGREEN="#07ef02",PTURQ="#04c9b9",sceneSwitchArrowViz=!1,sceneSwitchArrowVizHover=
!1,writtenMessageViz=!1,turnaround,currentDrawPath={path:[],color:"black"},tileId=1,isDrawing=!1,graffitiCanvasOpen=!1,graffitiCanvasW,graffitiCanvasH,graffitiCanvasX,graffitiCanvasY,largeImgHeight,smallImgHeight,SCALEFACTOR,currentTile,toiletImg1,toiletImg2,toiletPaperImg1,toiletPaperImg2,mirrorImg1,mirrorImg2,sinkImg1,sinkImg2,towelImg1,towelImg2,monospace,acki,amali,candy,clemina,jsKang,reallyFree,syifana,tilesHelper,tiles,startIndex=0,endIndex=120,triangleParams,graffitiFont,graffitiFontSize,
mobileGraffitiFontSize=20,desktopGraffitiFontSize=80,messageFont,messageFontSize,mobileFontSize=20,desktopFontSize=40,isMobile,SNAPSHOT_TIME=2E4,eventBuffer=[],BASE_TILE_WIDTH=245,GRAFFITI_TO_BASE_SCALE,BASE_TO_SMALL_TILE_SCALE,BASE_TO_GRAFFITI_SCALE,paintColors=[PBLUE,PPINK,PPEACH,PPURPLE,PYELLOW,PORANGE,PGREEN,PTURQ],TEXT_ANGLES=[0,10,350,20,340],lineupSound,arrowSound,openTileSound,closeTileSound,writingSound,flushToiletSound,tpSound,mirrorSound,waterSound,leavingSound,writingSoundIsPlaying=!1,
allSounds,tileHovered,TAKEN_TIME_LIMIT=12E4;function createUUID(){return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,function(a){return(a^crypto.getRandomValues(new Uint8Array(1))[0]&15>>a/4).toString(16)})}var SESSION_ID=createUUID();function dataSent(a,b){}
function preload(){toiletImg1=loadImage("img/toiletImg1.png");toiletImg2=loadImage("img/toiletImg2.png");toiletPaperImg1=loadImage("img/tpImg1.png");toiletPaperImg2=loadImage("img/tpImg2.png");mirrorImg1=loadImage("img/mirrorImg1.png");mirrorImg2=loadImage("img/mirrorImg2.png");sinkImg1=loadImage("img/sinkImg1.png");sinkImg2=loadImage("img/sinkImg2.png");towelImg1=loadImage("img/towelImg1.png");towelImg2=loadImage("img/towelImg2.png");incon=loadFont("fonts/Incon.ttf");acki=loadFont("fonts/Acki.ttf");
amali=loadFont("fonts/Amali.ttf");candy=loadFont("fonts/Candy.ttf");clemina=loadFont("fonts/Clemina.otf");jsKang=loadFont("fonts/JsKang.ttf");reallyFree=loadFont("fonts/ReallyFree.ttf");syifana=loadFont("fonts/Syifana.ttf");lineupSound=document.createElement("audio");arrowSound=document.createElement("audio");openTileSound=document.createElement("audio");closeTileSound=document.createElement("audio");writingSound=document.createElement("audio");letterSound=document.createElement("audio");flushToiletSound=
document.createElement("audio");tpSound=document.createElement("audio");mirrorSound=document.createElement("audio");waterSound=document.createElement("audio");leavingSound=document.createElement("audio");lineupSound.canPlayType("audio/mpeg")&&lineupSound.setAttribute("src","audio/lineupSound.mp3");arrowSound.canPlayType("audio/mpeg")&&arrowSound.setAttribute("src","audio/arrowSound.mp3");openTileSound.canPlayType("audio/mpeg")&&openTileSound.setAttribute("src","audio/openTileSound.mp3");closeTileSound.canPlayType("audio/mpeg")&&
closeTileSound.setAttribute("src","audio/closeTileSound.mp3");writingSound.canPlayType("audio/mpeg")&&writingSound.setAttribute("src","audio/writingSound.mp3");letterSound.canPlayType("audio/mpeg")&&letterSound.setAttribute("src","audio/letterSound.mp3");flushToiletSound.canPlayType("audio/mpeg")&&flushToiletSound.setAttribute("src","audio/flushToiletSound.mp3");tpSound.canPlayType("audio/mpeg")&&tpSound.setAttribute("src","audio/tpSound.mp3");mirrorSound.canPlayType("audio/mpeg")&&mirrorSound.setAttribute("src",
"audio/mirrorSound.mp3");waterSound.canPlayType("audio/mpeg")&&waterSound.setAttribute("src","audio/waterSound.mp3");leavingSound.canPlayType("audio/mpeg")&&leavingSound.setAttribute("src","audio/leavingSound.mp3")}function calculateCanvasWidth(a,b){return a}function calculateCanvasHeight(a,b){return b}function calculateGraffitiCanvasWidth(a,b){return.8*a}function calculateGraffitiCanvasHeight(a,b){return 4/7*calculateGraffitiCanvasWidth(a,b)}
function calculateGraffitiCanvasPositionX(a,b,c){return a/2-c/2}function calculateGraffitiCanvasPositionY(a,b){return b/20}function calculateScaleFactor(a,b){return a/b}function isScreenMobile(){return 800>=window.innerWidth?!0:!1}
function scaleAllTheThings(a,b){console.log("scale");canvasWidth=calculateCanvasWidth(a,b);canvasHeight=calculateCanvasHeight(a,b);graffitiCanvasW=calculateGraffitiCanvasWidth(canvasWidth,canvasHeight);graffitiCanvasH=calculateGraffitiCanvasHeight(canvasWidth,canvasHeight);graffitiCanvasX=calculateGraffitiCanvasPositionX(canvasWidth,canvasHeight,graffitiCanvasW);graffitiCanvasY=calculateGraffitiCanvasPositionY(canvasWidth,canvasHeight);toiletImg1.resize(0,canvasHeight);toiletImg2.resize(0,canvasHeight);
toiletPaperImg1.resize(0,canvasHeight/4.4);toiletPaperImg2.resize(0,canvasHeight/4.4);mirrorImg1.resize(0,canvasHeight);mirrorImg2.resize(0,canvasHeight);sinkImg1.resize(0,canvasHeight);sinkImg2.resize(0,canvasHeight);towelImg1.resize(0,canvasHeight/2.5);towelImg2.resize(0,canvasHeight/2.5);GRAFFITI_TO_BASE_SCALE=BASE_TILE_WIDTH/graffitiCanvasW;BASE_TO_SMALL_TILE_SCALE=currentTile.width/BASE_TILE_WIDTH;BASE_TO_GRAFFITI_SCALE=graffitiCanvasW/BASE_TILE_WIDTH;SCALEFACTOR=calculateScaleFactor(currentTile.width,
graffitiCanvasW)}function makeToolButtons(a,b,c,d){}function snapshotter(){window.setTimeout(function(){console.log("taking snapshot");takeSnapshot();snapshotter()},SNAPSHOT_TIME+Math.random()*SNAPSHOT_TIME)}function getScreenOrientation(){canvasWidth>=canvasHeight?screenOrientation="horizontal":canvasWidth<=canvasHeight&&(screenOrientation="vertical")}
function chooseFontSize(){isMobile?(graffitiFontSize=mobileGraffitiFontSize,messageFontSize=mobileFontSize):(graffitiFontSize=desktopGraffitiFontSize,messageFontSize=desktopFontSize)}
function setup(){setAttributes("antialias",!0);canvasWidth=calculateCanvasWidth(window.innerWidth,window.innerHeight);canvasHeight=calculateCanvasHeight(window.innerWidth,window.innerHeight);getScreenOrientation();isMobile=isScreenMobile();graffitiFont=chooseGraffitiFont();messageFont=incon;messageFont="courier";chooseFontSize();textSize(messageFontSize);textFont(messageFont);canvas=createCanvas(canvasWidth,canvasHeight);document.querySelectorAll("canvas").forEach(function(a){return a.imageSmoothingEnabled=
!0});tilesHelper=new Tiles(canvasWidth,canvasHeight);tiles=tilesHelper.tiles;currentTile=tiles[1];triangleParams=createTriangleParameters(40,screenOrientation);scaleAllTheThings(canvasWidth,canvasHeight);document.querySelectorAll("canvas").forEach(function(a){return a.imageSmoothingEnabled=!0});toolButtons=makeToolButtons(graffitiCanvasX,graffitiCanvasY,graffitiCanvasW,graffitiCanvasH);canvas.mousePressed(function(){var a=whatWasClicked(),b=a.clicked;clickActions(b,a.item);"nothing"!==b&&redraw()});
canvas.mouseMoved(hoverOnImg);canvas.touchStarted(startDrawPath);canvas.parent("canvascontainer");canvas.mouseReleased(endDrawPath);canvas.touchEnded(endDrawPath);firebase.initializeApp({apiKey:"AIzaSyAkqkz-UZyRSv_1QgfMjUeqX8mjZfg0MJE",authDomain:"throne-room-club.firebaseapp.com",databaseURL:"https://throne-room-club.firebaseio.com",storageBucket:"throne-room-club.appspot.com",messagingSenderId:"889776405480"});database=firebase.database();initializeFromSnapshot(firebase);document.addEventListener("keydown",
function(a){var b=a.key;if(!(143<currentTile.writing.length&&"Backspace"!==b)&&graffitiCanvasOpen)switch(letterSound.play(),b){case "Backspace":currentTile.writing=currentTile.writing.slice(0,-1);eventBuffer.push({tile:currentTile.tile,type:"remove_character"});break;case "Down":case "ArrowDown":break;case "Up":case "ArrowUp":break;case "Meta":case "Alt":case "Control":case "CapsLock":break;case "Tab":break;case "Left":case "ArrowLeft":break;case "Right":case "ArrowRight":break;case "Enter":currentTile.writing+=
"\n";eventBuffer.push({type:"add_character",tile:currentTile.tile,char:"\n"});break;case "Shift":break;case "Esc":case "Escape":break;default:currentTile.writing+=a.key,eventBuffer.push({type:"add_character",tile:currentTile.tile,char:a.key})}});document.addEventListener("keyup",function(a){letterSound.pause()});snapshotter()}
function whatWasClicked(){if(arrowMouseCheck()&&sceneSwitchArrowViz)return{clicked:"arrowClicked",item:void 0};if("preline"==scene){var a=joinLine();if("preline"==scene&&a)return{clicked:"joinLineClicked",item:void 0}}if(("toilet"==scene||"sink"==scene||"mirror"==scene||"end"==scene)&&graffitiCanvasOpen){a=toolMouseCheck();if("undefined"!==typeof a)return{clicked:"toolClicked",item:a};if(inGraffitiCanvasMouseCheck())return{clicked:"canvasClicked",item:void 0}}if(smallImgMouseCheck())return console.log("small"),
{clicked:"smallImgClicked",item:void 0};if("toilet"==scene||"sink"==scene||"mirror"==scene||"end"==scene)if(a=tileMouseCheck(),"undefined"!==typeof a)return{clicked:"tileClicked",item:a};return bigImgMouseCheck()?{clicked:"bigImgClicked",item:void 0}:{clicked:"nothing",item:void 0}}
function clickActions(a,b){graffitiCanvasOpen&&"canvasClicked"!==a?toggleGraffitiCanvas(void 0):"joinLineClicked"==a?(lineupSound.play(),sceneSwitch()):"arrowClicked"==a?(arrowSound.play(),sceneSwitchArrowViz=!1,sceneSwitch()):"toolClicked"==a?handleToolClick(b):"canvasClicked"==a?(startDrawPath(),writingSound.play()):"bigImgClicked"==a?largeImgClicked():"smallImgClicked"==a?smallImgClicked():"tileClicked"==a?(toggleGraffitiCanvas(b),startDrawPath()):"nothing"!=a&&console.log("ERROR: clickActions received item it cannot handle. wasClicked="+
a+" item="+b)}function bigImgMouseCheck(){if("toilet"==scene){if(hoverCheck(canvasWidth/2-toiletImg1.width/2,0,toiletImg1.width,toiletImg2.height))return!0}else if("mirror"==scene){if(hoverCheck(canvasWidth/2-mirrorImg1.width/2,0,mirrorImg1.width,mirrorImg2.height))return!0}else if("sink"==scene){if(hoverCheck(canvasWidth/2-sinkImg1.width/2,0,sinkImg1.width,sinkImg2.height))return!0}else return!1}
function smallImgMouseCheck(){if("toilet"==scene){if(hoverCheck(canvasWidth/1.5,240,toiletPaperImg1.width,toiletPaperImg1.height))return!0}else return!1}function joinLine(){return 0<mouseX&&mouseX<canvasWidth&&0<mouseY&&mouseY<canvasHeight?!0:!1}
function hoverOnImg(){if(!graffitiCanvasOpen){if(!writtenMessageViz){if("toilet"==scene||"mirror"==scene||"sink"==scene||"end"==scene){var a=tileHovered;tileHovered=tilesHelper.getTileForCoord(mouseX,mouseY,startIndex);"undefined"!==typeof tileHovered&&displaySmallTileGraffitiForASingleTile(tileHovered,!0);var b=(tileHovered||{}).tile||-1;"undefined"!==typeof a&&a.tile!=b&&displaySmallTileGraffitiForASingleTile(a)}"toilet"==scene?(drawIfMouseOver(canvasWidth/2-toiletImg1.width/2,0,toiletImg1.width,
toiletImg1.height,100,100,toiletImg1),drawIfMouseOver(canvasWidth/1.5,240,toiletPaperImg1.width,toiletPaperImg1.height,100,100,toiletPaperImg1)):"mirror"==scene?drawIfMouseOver(canvasWidth/2-mirrorImg1.width/2,0,mirrorImg1.width,mirrorImg1.height,100,100,mirrorImg1):"sink"==scene?(drawIfMouseOver(canvasWidth/2-sinkImg1.width/2,0,sinkImg1.width,sinkImg1.height,100,100,sinkImg1),drawIfMouseOver(canvasWidth/1.5,240,towelImg1.width,towelImg1.height,100,100,towelImg1)):"end"==scene&&endDrawText()}sceneSwitchArrowViz&&
arrowMouseCheck()?(sceneSwitchArrowVizHover=!0,drawSceneSwitchArrow(DYELLOW,LYELLOW)):sceneSwitchArrowViz&&(sceneSwitchArrowVizHover=!1,drawSceneSwitchArrow(DBLUE,LBLUE))}}
function largeImgClicked(){"toilet"==scene?(flushToiletSound.play(),writtenMessageViz=!0,window.setTimeout(function(){writtenMessageViz=!1;redraw()},standardTimer)):"mirror"==scene?(mirrorSound.play(),writtenMessageViz=!0,window.setTimeout(function(){writtenMessageViz=!1;redraw()},standardTimer)):"sink"==scene&&(waterSound.play(),writtenMessageViz=!0,window.setTimeout(function(){writtenMessageViz=!1;redraw()},standardTimer))}function smallImgClicked(){"toilet"==scene&&tpSound.play()}
function startDrawPath(){writingSound.play();if(graffitiCanvasOpen)return isDrawing=!0,currentDrawPath={path:[],color:currentColor},currentTile.drawing.push(currentDrawPath),!1}function endDrawPath(){isDrawing=!1;var a={type:"add_path",tile:currentTile.tile,path:currentDrawPath};writingSound.pause();eventBuffer.push(a)}function translateThenScale(a,b,c,d){return{x:(a.x-b)*d,y:(a.y-c)*d}}function scaleThenTranslate(a,b,c,d){return{x:d*a.x+b,y:d*a.y+c}}
function captureDrawing(){if(isDrawing&&inGraffitiCanvasMouseCheck()){var a=translateThenScale({x:mouseX,y:mouseY},graffitiCanvasX,graffitiCanvasY,GRAFFITI_TO_BASE_SCALE);currentDrawPath.path.push(a)}}function drawTile(a,b){push();strokeWeight(0);a.taken?fill(DPINK):b?fill(LYELLOW):""!=a.writing||0<a.drawing.length?fill(DPEACH):fill(LPEACH);rect(a.position.x,a.position.y,a.width,a.height);pop()}function chooseColor(){return random(paintColors)}
function chooseGraffitiFont(){fonts=[acki,amali,candy,clemina,jsKang,reallyFree,syifana];return random(fonts)}function chooseTextAngle(){return random(.5,1)}function drawTileDrawing(a,b,c,d){push();noFill();strokeWeight(5*b/2);a=a.drawing;for(var e=0;e<a.length;e++){var f=a[e];if("undefined"!==typeof f.path){stroke(f.color);beginShape();for(var g=0;g<f.path.length;g++){var h=scaleThenTranslate(f.path[g],c,d,b);vertex(h.x,h.y)}endShape()}}pop()}
function drawTileWriting(a,b,c,d,e,f){push();noStroke();textFont(fonts[a.tile%fonts.length]);textSize(graffitiFontSize);fill(currentColor);scale(b,b);textAlign(CENTER,CENTER);text(a.writing,c,d,e,f);pop()}function graffitiTools(a){}function displayLargeTileGraffiti(a){graffitiCanvasOpen&&(drawTileDrawing(a,BASE_TO_GRAFFITI_SCALE,graffitiCanvasX,graffitiCanvasY),drawTileWriting(a,1,graffitiCanvasX,graffitiCanvasY,graffitiCanvasW,graffitiCanvasH))}
function displaySmallTileGraffitiForASingleTile(a,b){var c=a.position.x/SCALEFACTOR,d=a.position.y/SCALEFACTOR,e=a.width/SCALEFACTOR,f=a.height/SCALEFACTOR;drawTile(a,b||!1);a.writing!==[]&&(drawTileDrawing(a,BASE_TO_SMALL_TILE_SCALE,a.position.x,a.position.y),drawTileWriting(a,SCALEFACTOR,c,d,e,f))}function displaySmallTileGraffiti(){for(var a=startIndex;a<endIndex;a++)displaySmallTileGraffitiForASingleTile(tiles[a])}
function tileMouseCheck(){return tilesHelper.getTileForCoord(mouseX,mouseY,startIndex)}function saveTile(a){if(0<eventBuffer.length){var b=collapseEventBuffer(eventBuffer),c=database.ref("log");a=c.push(b[0]);var d=b.slice(1);b={};for(var e in d)b.$jscomp$loop$prop$i$13=e,a=a.then(function(a){return function(){return c.push(d[a.$jscomp$loop$prop$i$13])}}(b)),b={$jscomp$loop$prop$i$13:b.$jscomp$loop$prop$i$13};eventBuffer=[]}redraw()}
function hoverCheck(a,b,c,d){return mouseX>a&&mouseX<a+c&&mouseY>b&&mouseY<b+d?!0:!1}function drawIfMouseOver(a,b,c,d,e,f,g){mouseX>a-e&&mouseX<a+c+e&&mouseY>b-f&&mouseY<b+d+f&&image(g,a,b)}function hoverReplace(a,b,c,d,e,f){mouseX>a&&mouseX<a+c&&mouseY>d/1.2&&mouseY<b+d?image(e,a,b):image(f,a,b)}function clearTile(){currentTile.drawing=[];currentTile.writing="";eventBuffer.push({type:"clear_tile",tile:currentTile.tile})}function clearTileChanges(){currentTile.drawing=[];currentTile.writing=""}
function handleToolClick(a){"write"!==a.text&&("CLEAR"===a.text?clearTileChanges():console.log("ERROR: handleToolClick received a text it could not handle: tool="+JSON.stringify(a)))}function toolMouseCheck(){var a;for(a in toolButtons){var b=toolButtons[a];if(mouseX>b.x&&mouseX<b.x+b.width&&mouseY>b.y&&mouseY<b.y+b.height){b.select=!0;var c=b}else b.select=!1}return c}
function toggleGraffitiCanvas(a){var b=currentTile;graffitiCanvasOpen?0==inGraffitiCanvasMouseCheck()&&(closeTileSound.play(),b.taken=!1,delete b.takenTime,eventBuffer.push({type:"untake",tile:b.tile}),saveTile(b),graffitiCanvasOpen=!graffitiCanvasOpen,noLoop()):(openTileSound.play(),currentColor=chooseColor(),graffitiFont=chooseGraffitiFont(),currentAngle=chooseTextAngle(),loop(),currentTile=a,!1===currentTile.taken&&(currentTile.taken=!0,a=Date.now(),currentTile.takenTime=a,eventBuffer.push({type:"take",
tile:currentTile.tile,session:SESSION_ID,ts:a}),saveTile(currentTile)),graffitiCanvasOpen=!graffitiCanvasOpen)}function inGraffitiCanvasMouseCheck(){return mouseX>graffitiCanvasX&&mouseX<graffitiCanvasX+graffitiCanvasW&&mouseY>graffitiCanvasY&&mouseY<graffitiCanvasY+graffitiCanvasH?!0:!1}function drawGraffitiCanvas(){push();stroke(DPEACH);strokeWeight(3);fill(LPEACH);rect(graffitiCanvasX,graffitiCanvasY,graffitiCanvasW,graffitiCanvasH);pop()}
function writtenMessage(a){push();fill("white");rect(graffitiCanvasX,graffitiCanvasY,graffitiCanvasW,graffitiCanvasH/2);fill("black");textSize(messageFontSize);textFont(messageFont);textAlign(CENTER,CENTER);text(a,graffitiCanvasX,graffitiCanvasY,graffitiCanvasW,graffitiCanvasH/2);pop()}function stopSounds(){allSounds=[lineupSound,openTileSound,closeTileSound,writingSound,flushToiletSound,tpSound,mirrorSound,waterSound,leavingSound];for(var a=0;a<allSounds.length;a++)allSounds[a].pause()}
function displayWelcomeMessage(){writtenMessageViz=!0;window.setTimeout(function(){writtenMessageViz=!1;redraw()},standardTimer)}
function sceneSwitch(){"preline"==scene?scene="line":"line"==scene?(scene="toilet",displayWelcomeMessage(),leaveSceneTimer(standardTimer),noLoop()):"toilet"==scene?(stopSounds(),scene="sink",redraw(),startIndex=120,endIndex=240,displayWelcomeMessage(),leaveSceneTimer(standardTimer),noLoop()):"sink"==scene?(stopSounds(),scene="mirror",startIndex=240,endIndex=360,redraw(),displayWelcomeMessage(),leaveSceneTimer(standardTimer),noLoop()):"mirror"==scene&&(stopSounds(),scene="end",startIndex=360,endIndex=
480,redraw(),displayWelcomeMessage(),noLoop())}function createTriangleParameters(a,b){b=canvasHeight/1.2;var c=canvasWidth-a;var d=c-1.5*a;return{length:a,y1:b,y2:b+2*a,x3:c,y3:b+a,x1:d,x2:d}}function drawSceneSwitchArrow(a,b){sceneSwitchArrowViz=!0;push();stroke(a);fill(b);strokeWeight(7);a=triangleParams;triangle(a.x1,a.y1,a.x2,a.y2,a.x3,a.y3);pop()}function redrawSceneSwitchArrow(){sceneSwitchArrowViz=!0;redraw()}
function displaySceneSwitchArrow(){sceneSwitchArrowViz&&(sceneSwitchArrowVizHover?drawSceneSwitchArrow(DYELLOW,LYELLOW):drawSceneSwitchArrow(DBLUE,LBLUE))}function leaveSceneTimer(a){window.setTimeout(redrawSceneSwitchArrow,a)}
function arrowMouseCheck(){var a=mouseX,b=mouseY,c=triangleParams.x1,d=triangleParams.y1,e=triangleParams.x2,f=triangleParams.y2,g=triangleParams.x3,h=triangleParams.y3,k=floor(abs((e-c)*(h-d)-(g-c)*(f-d))),l=floor(abs((c-a)*(f-b)-(e-a)*(d-b)));e=floor(abs((e-a)*(h-b)-(g-a)*(f-b)));a=floor(abs((g-a)*(d-b)-(c-a)*(h-b)));return l+e+a<=k?!0:!1}function startTimer(){}
function preLineupDraw(){push();background("black");textAlign(CENTER,CENTER);fill(DBLUE);rectMode(CENTER);text("Enter the imaginary bathroom?",canvasWidth/2,canvasHeight/2,canvasWidth/1.5,canvasHeight/2);pop()}
function lineupDraw(){var a="You are in line\n"+bathroomLineUpTime;push();background("black");0==frameCount%60&&-1<bathroomLineUpTime&&bathroomLineUpTime--; -1==bathroomLineUpTime&&(bathroomLineUpTime=0,lineupSound.pause(),drawSceneSwitchArrow(DBLUE,LBLUE),noLoop());textAlign(CENTER,CENTER);fill(DBLUE);rectMode(CENTER);text(a,canvasWidth/2,canvasHeight/2,canvasWidth/1.5,canvasHeight/2);pop()}
function toiletDraw(){graffitiCanvasOpen?(drawGraffitiCanvas(),displayLargeTileGraffiti(currentTile),captureDrawing()):(background(LBLUE),displaySmallTileGraffiti(),"undefined"!==typeof tileHovered&&displaySmallTileGraffitiForASingleTile(tileHovered,!0),image(toiletImg1,canvasWidth/2-toiletImg1.width/2,0),image(toiletPaperImg1,canvasWidth/1.5,240),writtenMessageViz&&writtenMessage("what are you ready to flush away?"));displaySceneSwitchArrow()}
function sinkDraw(){graffitiCanvasOpen?(drawGraffitiCanvas(),displayLargeTileGraffiti(currentTile),captureDrawing()):(background(LBLUE),displaySmallTileGraffiti(),image(sinkImg1,canvasWidth/2-sinkImg1.width/2,0),image(towelImg1,canvasWidth/1.5,240),writtenMessageViz&&writtenMessage("what do your hands want to do?"));displaySceneSwitchArrow()}
function mirrorDraw(){graffitiCanvasOpen?(drawGraffitiCanvas(),displayLargeTileGraffiti(currentTile),captureDrawing()):(background(LBLUE),displaySmallTileGraffiti(),image(mirrorImg1,canvasWidth/2-mirrorImg1.width/2,0),writtenMessageViz&&writtenMessage("what do you want to see?"));displaySceneSwitchArrow()}
function endDrawText(){push();textAlign(CENTER,CENTER);fill("black");rectMode(CENTER);textFont(messageFont);textSize(messageFontSize);text("Thank you for visiting the imaginary bathroom",canvasWidth/2,canvasHeight/2,canvasWidth/1.5,canvasHeight/2);pop()}function endDraw(){graffitiCanvasOpen?(drawGraffitiCanvas(),displayLargeTileGraffiti(currentTile),captureDrawing()):(background(LBLUE),displaySmallTileGraffiti(),endDrawText())}
function draw(){"preline"==scene?preLineupDraw():"line"==scene?lineupDraw():"toilet"==scene?toiletDraw():"sink"==scene?sinkDraw():"mirror"==scene?mirrorDraw():"end"==scene&&endDraw()}function buildMap(a){for(var b in tiles){var c=tiles[b];"undefined"===typeof a[b]?console.log("ERROR - tileId="+b+" in tiles map but not in snapshot"):(c.drawing=a[b].drawing||[],c.writing=a[b].writing||"",c.taken=a[b].taken||!1)}redraw()}
function collapseEventBuffer(a){var b="",c=[],d;for(d in a){var e=a[d];"add_character"===e.type?b+=e.char:"remove_character"===e.type?b=b.slice(0,-1):c.push(e)}0<b.length&&c.push({tile:a[0].tile,type:"update_writing",writing:b});return c}function takeSnapshot(){database.ref("log").push({type:"snapshot",session:SESSION_ID})}
function handleEvent(a,b){if("add_path"===a.type)b=tiles[a.tile],b.drawing.push(a.path),displaySmallTileGraffitiForASingleTile(b),displayLargeTileGraffiti(b);else if("update_writing"===a.type)b=tiles[a.tile],b.writing=a.writing,displaySmallTileGraffitiForASingleTile(b),displayLargeTileGraffiti(b);else if("clear_tile"===a.type)b=tiles[a.tile],b.drawing={path:[],color:"black"},b.writing="",b.taken=!1,delete b.takenTime,displaySmallTileGraffitiForASingleTile(b),displayLargeTileGraffiti(b);else if("take"===
a.type)b=tiles[a.tile],b.taken=!0,b.takenTime=ts;else if("untake"===a.type)b=tiles[a.tile],b.taken=!1,delete b.takenTime;else if("snapshot"===a.type){if(a.session===SESSION_ID){for(var c in tiles){a=tiles[c];var d=Date.now(),e=a.takenTime||0;a.taken&&d-e>TAKEN_TIME_LIMIT&&(a.taken=!1,delete a.takenTime)}database.ref("snapshot").push({tiles:tiles,key:b,session:SESSION_ID})}}else console.log("received event type we could not handle: "+a.type)}
function initializeFromSnapshot(a){var b=a.database();a=b.ref("/snapshot").orderByKey().limitToLast(1);performance.now();a.once("value",function(a){if(null===a.val())return b.ref("/log").orderByKey().on("child_added",function(a){var b=a.val();handleEvent(b,a.key)},printErrors);b.ref("/snapshot").orderByKey().limitToLast(1).once("child_added",function(a){a=a.val();var c=a.key;buildMap(a.tiles);return b.ref("/log").orderByKey().startAt(c).on("child_added",function(a){var b=a.val();handleEvent(b,a.key)},
printErrors)},printErrors)})}function printErrors(a){console.log(a)}window.addEventListener("beforeunload",function(a){currentTile.taken=!1;delete currentTile.takenTime;eventBuffer.push({type:"untake",tile:currentTile.tile});saveTile(currentTile)});
